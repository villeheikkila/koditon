// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0

package db

import (
	"encoding/json"

	"github.com/jackc/pgx/v5/pgtype"
)

// Stores tasks that have exhausted all retry attempts for debugging and manual reprocessing.
type TaskQueueDeadLetterQueue struct {
	DlqID          int64       `db:"dlq_id" json:"dlq_id"`
	OriginalTaskID int64       `db:"original_task_id" json:"original_task_id"`
	EntityID       string      `db:"entity_id" json:"entity_id"`
	TaskType       string      `db:"task_type" json:"task_type"`
	Priority       int64       `db:"priority" json:"priority"`
	TotalAttempts  int64       `db:"total_attempts" json:"total_attempts"`
	FirstError     pgtype.Text `db:"first_error" json:"first_error"`
	LastError      string      `db:"last_error" json:"last_error"`
	// JSON array of {attempt, error, timestamp} objects for each failure.
	ErrorHistory json.RawMessage `db:"error_history" json:"error_history"`
	// Snapshot of entity metadata at time of failure.
	TaskMetadata      []byte             `db:"task_metadata" json:"task_metadata"`
	OriginalCreatedAt pgtype.Timestamptz `db:"original_created_at" json:"original_created_at"`
	FirstAttemptedAt  pgtype.Timestamptz `db:"first_attempted_at" json:"first_attempted_at"`
	LastAttemptedAt   pgtype.Timestamptz `db:"last_attempted_at" json:"last_attempted_at"`
	MovedToDlqAt      pgtype.Timestamptz `db:"moved_to_dlq_at" json:"moved_to_dlq_at"`
	// Set when task is manually requeued for retry.
	RequeuedAt pgtype.Timestamptz `db:"requeued_at" json:"requeued_at"`
	// Number of times this task has been requeued from DLQ.
	RequeueCount int64 `db:"requeue_count" json:"requeue_count"`
}

type TaskQueueEntityRegistry struct {
	EntityID           string             `db:"entity_id" json:"entity_id"`
	EntityType         string             `db:"entity_type" json:"entity_type"`
	Status             string             `db:"status" json:"status"`
	SchedulingStrategy string             `db:"scheduling_strategy" json:"scheduling_strategy"`
	Metadata           []byte             `db:"metadata" json:"metadata"`
	CreatedAt          pgtype.Timestamptz `db:"created_at" json:"created_at"`
	UpdatedAt          pgtype.Timestamptz `db:"updated_at" json:"updated_at"`
}

type TaskQueueTask struct {
	TaskID   int64  `db:"task_id" json:"task_id"`
	EntityID string `db:"entity_id" json:"entity_id"`
	TaskType string `db:"task_type" json:"task_type"`
	Status   string `db:"status" json:"status"`
	// Higher values = higher priority. Default 0, use negative for low priority, positive for high priority.
	Priority       int64              `db:"priority" json:"priority"`
	Attempt        int64              `db:"attempt" json:"attempt"`
	MaxAttempts    int64              `db:"max_attempts" json:"max_attempts"`
	LastError      pgtype.Text        `db:"last_error" json:"last_error"`
	WorkerID       pgtype.Text        `db:"worker_id" json:"worker_id"`
	ScheduledFor   pgtype.Timestamptz `db:"scheduled_for" json:"scheduled_for"`
	StartedAt      pgtype.Timestamptz `db:"started_at" json:"started_at"`
	CompletedAt    pgtype.Timestamptz `db:"completed_at" json:"completed_at"`
	RunOn          pgtype.Date        `db:"run_on" json:"run_on"`
	QueueMessageID pgtype.Int8        `db:"queue_message_id" json:"queue_message_id"`
	CreatedAt      pgtype.Timestamptz `db:"created_at" json:"created_at"`
	UpdatedAt      pgtype.Timestamptz `db:"updated_at" json:"updated_at"`
}
